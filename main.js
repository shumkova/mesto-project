(()=>{"use strict";var e,t,n,o="modal_state_opened",r=function(e){if("Escape"===e.key){var t=document.querySelector(".".concat(o));t&&i(t)}},a=function(e){var t=e.target;if(t.classList.contains("modal__close")||t.classList.contains(o)){var n=document.querySelector(".".concat(o));i(n)}},c=function(e){e.classList.add(o),document.addEventListener("keydown",r),e.addEventListener("mousedown",a)},i=function(e){e.classList.remove(o),document.removeEventListener("keydown",r),e.removeEventListener("mousedown",a)},u="https://mesto.nomoreparties.co/v1/plus-cohort-15",l="0a6f2833-af50-47bd-9ef3-217391db1563",s=function(t,n){var o=t.querySelector(".".concat(n.id,"-error"));n.classList.remove(e.inputErrorClass),o&&(o.classList.remove(e.errorActiveClass),o.textContent="")},d=function(e,t){t.disabled=!!function(e){return e.some((function(e){return!e.validity.valid}))}(e)},m=function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(t){var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.submitButtonSelector);d(n,o),n.forEach((function(r){r.addEventListener("input",(function(){(function(t,n){n.validity.patternMismatch?n.setCustomValidity(n.dataset.errorMessage):n.setCustomValidity(""),n.validity.valid?s(t,n):function(t,n,o){var r=t.querySelector(".".concat(n.id,"-error"));n.classList.add(e.inputErrorClass),r&&(r.textContent=o,r.classList.add(e.errorActiveClass))}(t,n,n.validationMessage)})(t,r),d(n,o)}))}))}(t)},f=document.querySelector(".profile__avatar-image"),v=document.querySelector(".profile__name"),y=document.querySelector(".profile__about"),_=document.querySelector('[data-modal="edit-profile"]'),p=_.querySelector(".form"),S=p.querySelector('input[name="name"]'),h=p.querySelector('input[name="about"]'),q=document.querySelector('[data-open-modal="edit-profile"]'),b=p.querySelector(".form__submit"),C=document.querySelector('[data-open-modal="edit-avatar"]'),E=document.querySelector('[data-modal="edit-avatar"]'),L=E.querySelector(".form"),g=L.querySelector('input[name="avatar-img-link"]'),k=L.querySelector(".form__submit"),x=function(e){f.src=e.avatar,v.textContent=e.name,y.textContent=e.about},j="card__like-button_active",T=document.querySelector(".cards__list"),D=document.querySelector("#card").content,A=document.querySelector('[data-modal="image"]'),P=document.querySelector('[data-modal="delete"]'),z=P.querySelector(".form").querySelector(".form__submit"),w={id:"",element:""},B=function(e){var n=D.cloneNode(!0),o=n.querySelector(".card__image"),r=n.querySelector(".card__title"),a=n.querySelector(".card__like-button"),i=n.querySelector(".card__likes-counter"),s=n.querySelector(".card__delete-button");return o.src=e.link,o.alt=e.name,r.textContent=e.name,i.textContent=e.likes.length,e.likes.some((function(e){return e._id===t}))&&a.classList.add(j),a.addEventListener("click",(function(t){var n,o;t.preventDefault(),a.disabled=!0,(n=a.classList.contains(j)?"DELETE":"PUT",o=e._id,fetch("".concat(u,"/cards/likes/").concat(o),{method:n,headers:{authorization:l}})).then((function(e){return e.ok?e.json():Promise.reject("Произошла ошибка: ".concat(e.status))})).then((function(e){a.classList.toggle(j),i.textContent=e.likes.length})).catch((function(e){console.log(e)})).finally((function(){a.disabled=!1}))})),t===e.owner._id?s.addEventListener("click",(function(t){t.preventDefault(),w.element=t.target.closest(".card"),w.id=e._id,c(P)})):s.remove(),o.addEventListener("click",(function(){J(o.src,o.alt,r.textContent),c(A)})),n},N=A.querySelector(".modal__image"),O=A.querySelector(".modal__img-caption"),J=function(e,t,n){N.src=e,N.alt=t,O.textContent=n},M=document.querySelector('[data-modal="add-card"]'),H=M.querySelector(".form"),V=H.querySelector('input[name="card-name"]'),F=H.querySelector('input[name="card-img-link"]'),U=document.querySelector('[data-open-modal="add-card"]'),G=H.querySelector(".form__submit");n=document.querySelectorAll("[data-modal]"),setTimeout((function(){n.forEach((function(e){e.classList.remove("modal_state_preload")}))}),100),fetch("".concat(u,"/users/me"),{headers:{authorization:l}}).then((function(e){return e.ok?e.json():Promise.reject("Не удалось загрузить данные пользователя: ".concat(e.status))})).then((function(e){x(e),t=e._id})).catch((function(e){console.log(e)})),fetch("".concat(u,"/cards"),{headers:{authorization:l}}).then((function(e){return e.ok?e.json():Promise.reject("Не удалось загрузить посты: ".concat(e.status))})).then((function(e){var t=document.createDocumentFragment();e.forEach((function(e){t.append(B(e))})),T.append(t)})),p.addEventListener("submit",(function(e){e.preventDefault(),b.disabled=!0;var t=b.textContent;b.textContent=b.dataset.loadingText,function(e,t){return fetch("".concat(u,"/users/me"),{method:"PATCH",headers:{authorization:l,"Content-Type":"application/json"},body:JSON.stringify({name:e.value,about:t.value})})}(p.elements.name,p.elements.about).then((function(e){return e.ok?e.json():Promise.reject("Не удалось обновить данные пользователя: ".concat(e.status))})).then((function(e){x(e),i(_)})).catch((function(e){console.log(e)})).finally((function(){b.textContent=t,b.disabled=!1}))})),L.addEventListener("submit",(function(e){e.preventDefault(),k.disabled=!0;var t,n=k.textContent;k.textContent=k.dataset.loadingText,(t=g,fetch("".concat(u,"/users/me/avatar"),{method:"PATCH",headers:{authorization:l,"Content-Type":"application/json"},body:JSON.stringify({avatar:t.value})})).then((function(e){return e.ok?e.json():Promise.reject("Не удалось обновить аватар: ".concat(e.status))})).then((function(e){f.src=e.avatar,L.reset(),i(E)})).catch((function(e){console.log(e)})).finally((function(){k.textContent=n,k.disabled=!1}))})),q.addEventListener("click",(function(t){var n,o,r;t.preventDefault(),S.value=v.textContent,h.value=y.textContent,n=p,o=Array.from(n.querySelectorAll(e.inputSelector)),r=n.querySelector(e.submitButtonSelector),o.forEach((function(e){s(n,e)})),d(o,r),c(_)})),C.addEventListener("click",(function(e){e.preventDefault(),c(E)})),H.addEventListener("submit",(function(e){e.preventDefault(),G.disabled=!0;var t=G.textContent;G.textContent=G.dataset.loadingText,function(e,t){return fetch("".concat(u,"/cards"),{method:"POST",headers:{authorization:l,"Content-Type":"application/json"},body:JSON.stringify({name:e.value,link:t.value})})}(V,F).then((function(e){return e.ok?e.json():Promise.reject("Не удалось опубликовать пост:  ".concat(e.status))})).then((function(e){var t;t=e,T.prepend(B(t)),H.reset(),i(M)})).finally((function(){G.disabled=!1,G.textContent=t}))})),U.addEventListener("click",(function(e){e.preventDefault(),c(M)})),P.addEventListener("submit",(function(e){e.preventDefault(),z.disabled=!0;var t,n=z.textContent;z.textContent=z.dataset.loadingText,(t=w.id,fetch("".concat(u,"/cards/").concat(t),{method:"DELETE",headers:{authorization:l}})).then((function(e){if(!e.ok)return Promise.reject("Не удалось удалить карточку: ".concat(e.status));w.element.remove(),i(P)})).catch((function(e){console.log(e)})).finally((function(){z.disabled=!1,z.textContent=n}))})),e={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__submit",inactiveButtonClass:"form__submit_disabled",inputErrorClass:"form__input_type_error",errorActiveClass:"form__error_active"},Array.from(document.querySelectorAll(e.formSelector)).forEach((function(e){m(e)}))})();